$(function(){function t(t){var e,a=$(t.target),n=a.val(),r=a.attr("data-datepicker");r=/^(.*)\[((?:lt|gt))\](.*)$/.exec(r),r?($.datepicker.rangeDate=$.datepicker.validate($("input[data-datepicker^="+r[3]+"]").val()),$.datepicker.rangeDate&&($.datepicker.rangeDate.type=r[2])):$.datepicker.rangeDate=r,e=$.datepicker.validate(n)||$.datepicker.rangeDate||a.data("lastdate")||$.datepicker.getNowDate(),$.datepicker.show(e,a),a.data("lastdate",e)}function e(t){var e=$(t.target);e.closest(".wgt-dp").length<1&&!e.hasClass("input-datepicker")&&$.datepicker.hide()}function a(t){var e=t.keyCode;e>36&&41>e||e>47&&58>e||e>95&&106>e||8==e||9==e||13==e||173==e||t.preventDefault()}function n(e){var a=$(e.target),n=a.val(),r=$.datepicker.validate(n);r&&(a.val(r.y+"-"+r.m+"-"+r.d).trigger("formatcorrect.calendar"),t(e)),a.trigger("changedate.calendar")}function r(t){var e=$(t.target),a=$.datepicker.rangeDate,n=$.datepicker.validate(e.val());return n?void(a&&("lt"==a.type?new Date(n.m+"/"+n.d+"/"+n.y)<=new Date(a.m+"/"+a.d+"/"+a.y)||e.val("").trigger("formaterror.calendar",["开始日期不能大于结束日期"]):new Date(n.m+"/"+n.d+"/"+n.y)>=new Date(a.m+"/"+a.d+"/"+a.y)||e.val("").trigger("formaterror.calendar",["结束日期不能小于开始日期"]))):void(""!==e.val()&&e.val("").trigger("formaterror.calendar",["请输入正确的日期格式 例:yyyy-mm-dd"]))}$.datepicker=function(){function t(t){var e=Number(t);return e%400===0||e%100!==0&&e%4===0?1:0}function e(t,e){return"01"==t?e[12]:Number(t)<10?e["0"+(Number(t)-1)]:e[t]}function a(t,e,a){var n=a||"01",r=new Date(e+"/"+n+"/"+t);return 0===r.getDay()?7:r.getDay()}function n(t,e){$.each(t,function(t,a){e[t]=a})}function r(t,e){var a=t;if(0===arguments.length)return $.extend({},T);if("string"==typeof t){if(void 0===e)return T[t];a={},a[t]=e}return n(a,T),N}function d(t){var e='<a href="javascript:;" class="wgt-dp-btn btn-py" fn="prevYear"></a><a href="javascript:;" class="wgt-dp-btn btn-ny" fn="nextYear"></a>';e+='<a href="javascript:;" class="wgt-dp-btn btn-pm" fn="prevMonth"></a><a href="javascript:;" class="wgt-dp-btn btn-nm" fn="nextMonth"></a>',e+='<input type="text" class="wgt-dp-ft pd-tm pd-tm-yy" /><input type="text" class="wgt-dp-ft pd-tm pd-tm-mm" />',b=$('<div class="wgt-dp wgt-dp-'+t.skin+'" style="display:none;"><!--[if lte IE 6.5]><iframe style="filter:mask();"></iframe><![endif]--></div>'),D=$('<div class="wgt-dp-hd" />').html(e).appendTo(b),x=$('<div class="wgt-dp-bd" />').appendTo(b),t.container.append(b),M=$(".pd-tm-yy",D),j=$(".pd-tm-mm",D)}function i(n,r){n.m=String(n.m).length<2?"0"+n.m:n.m,n.d=String(n.d).length<2?"0"+n.d:n.d;var d,i,c=[],l={"01":31,"02":28+t(n.y),"03":31,"04":30,"05":31,"06":30,"07":31,"08":31,"09":30,10:31,11:30,12:31},o=l[n.m],p=e(n.m,l),s=a(n.y,n.m),g=(a(n.y,n.m,o),s>1?s-1:7),u=p-g,f=N.rangeDate?new Date(N.rangeDate.m+"/"+N.rangeDate.d+"/"+N.rangeDate.y):null,v=m();for(d=1;g>=d;d++)c.push("<b>"+(u+d)+"</b>");for(d=1;o>=d;d++){var h=n.m==v.m&&n.y==v.y&&d==v.d?' class="today"':"";if(f){var y="lt"==N.rangeDate.type?new Date(n.m+"/"+d+"/"+n.y)<=f:new Date(n.m+"/"+d+"/"+n.y)>=f;c.push(y?'<a href="javascript:;"'+h+">"+d+"</a>":"<b"+h+">"+d+"</b>")}else c.push('<a href="javascript:;"'+h+">"+d+"</a>")}for(d=1,i=42-o-g;i>=d;d++)c.push("<b>"+d+"</b>");if(r)switch($(r).attr("fn")){case"prevYear":return $('<div class="calendar-container" />').html(c.join("")).css("margin-left","-238px").prependTo(x);case"prevMonth":return $('<div class="calendar-container" />').html(c.join("")).css("margin-left","-238px").prependTo(x);case"nextYear":return $('<div class="calendar-container" />').html(c.join("")).appendTo(x);case"nextMonth":return $('<div class="calendar-container" />').html(c.join("")).appendTo(x)}x.html($('<div class="calendar-container" />').html(c.join("")))}function c(t){var e=$(window).height(),a=$(window).width(),n=b.outerHeight(),r=b.outerWidth(),d=t.outerHeight(),i=t.offset();return i.top=e-i.top<n?i.top-n:i.top+d,a-i.left<r&&(i.left=a-r),i}function l(t,e){var a=c(e);i(t),M.val(Number(t.y)),j.val(Number(t.m)),S=e,b.css({left:a.left,top:a.top}).show()}function o(){x.html(""),b.hide()}function p(e,a){var n=[31,28+t(e),31,30,31,30,31,31,30,31,30,31];return n[Number(a)-1]}function s(t,e){if(t){var a=$(e).attr("fn"),n="nextYear"===a||"nextMonth"===a?t.prev():t,r={prevYear:{marginLeft:0},prevMonth:{marginLeft:0},nextYear:{marginLeft:"-238px"},nextMonth:{marginLeft:"-238px"}};n.animate(r[a],300,"swing",function(){"nextYear"===a||"nextMonth"===a?$(this).remove():$(this).next().remove()})}}function g(t){var e;if("[object String]"===Object.prototype.toString.call(t)){if(e=/^(\d{1,4})-(\d{2})-(\d{2})$/.exec(t)){var a=new Date(e[1]+"/"+e[2]+"/"+e[3]);e={y:String(a.getFullYear()),m:a.getMonth()+1,d:a.getDate()},e.m=e.m<10?"0"+e.m:String(e.m),e.d=e.d<10?"0"+e.d:String(e.d)}}else t.y&&t.m&&t.d?(e=/^\d{1,4}$/.test(t.y)&&t.y>0,e=/^\d{1,2}$/.test(t.m)&&t.m>0&&t.m<13,e=/^\d{1,2}$/.test(t.d)&&t.d<=p(t.y,t.m)):(t.y&&(e=/^\d{1,4}$/.test(t.y)&&t.y>0),t.m&&(e=/^\d{1,2}$/.test(t.m)&&t.m>0&&t.m<13),t.d&&(e=/^\d{1,2}$/.test(t.d)));return e}function m(){var t=new Date,e=t.getMonth()+1,a=t.getDate();return{y:String(t.getFullYear()),m:10>e?"0"+e:String(e),d:10>a?"0"+a:String(a)}}function u(t){var e=Number(M.val()),a=Number(j.val()),n={prevYear:function(){0>e||(e--,M.val(e).trigger("change.calendar",$(t.target)))},prevMonth:function(){a--,1>a&&(a=12,e--,M.val(e).trigger("change.calendar",$(t.target))),j.val(a).trigger("change.calendar",$(t.target))},nextYear:function(){e++,M.val(e).trigger("change.calendar",$(t.target))},nextMonth:function(){a++,a>12&&(a=1,e++,M.val(e).trigger("change.calendar",$(t.target))),j.val(a).trigger("change.calendar",$(t.target))}};n[$(t.target).attr("fn")](t)}function f(t){$(t.target).addClass("pd-tm-fcs-state").select()}function v(t){$(t.target).removeClass("pd-tm-fcs-state")}function h(t,e){var a=M.val(),n=j.val();g({y:a})&&g({m:n})&&s(i({y:a,m:n,d:"01"},e),e)}function y(t){var e=$(t.target),a=e.val();e.hasClass("pd-tm-mm")&&e.val(a>12?12:1>a&&""!==a?1:a),g({m:j.val()})&&g({y:M.val()})&&j.trigger("change.calendar"),M.trigger("change.calendar")}function k(t){var e=t.keyCode;e>36&&41>e||e>47&&58>e||e>95&&106>e||8==e||9==e||13==e||t.preventDefault()}function w(t){var e=$(t.target);if(!e.hasClass("wgt-dp-btn")){var a={y:M.val(),m:j.val()<10?"0"+j.val():j.val(),d:e.html()<10?"0"+e.html():e.html()},n=a.y+"-"+a.m+"-"+a.d;S&&g(n)&&S.val(n).data("lastdate",a).trigger("changedate.calendar").trigger("formatcorrect.calendar")&&N.hide()}}var b,D,x,M,j,Y,S,N={},C={skin:"blue",type:"datepicker",container:$("body")},T=C;return d(T),b.on("keyup.calendar",".pd-tm-fcs-state",y),b.on("keydown.calendar",".pd-tm-fcs-state",k),b.on("contextmenu",".pd-tm",function(t){t.preventDefault()}),b.on("change.calendar",".pd-tm",h),b.on("blur.calendar",".pd-tm",v),b.on("focus.calendar",".pd-tm",f),b.on("click.calendar",".wgt-dp-btn",u),b.on("click.calendar","a",w),N.option=r,N.calDom=b,N.show=l,N.hide=o,N.rangeDate=Y,N.validate=g,N.getNowDate=m,N.keydownHandler=k,N}(),$.fn.datepicker=function(){var t;return t=$(this).is("input")?$(this).filter("input[data-datepicker]"):$(this).find("input[data-datepicker]"),t.each(function(){$(this).addClass("input-datepicker").attr("maxlength",10)}),this},$.fn.removeDatepicker=function(){var t;return t=$(this).is("input")?$(this).filter("input[data-datepicker]"):$(this).find("input[data-datepicker]"),t.each(function(){$(this).removeClass("input-datepicker").removeAttr("maxlength").removeData("lastdate")}),this};var d=document.all?"mousewheel.calendar":"DOMMouseScroll.calendar";$("body").on("click.calendar focus.calendar","input[data-datepicker]",t),$(document).bind("mousedown.calendar",e),$("body").on("keyup.calendar","input[data-datepicker]",n),$("body").on("keydown.calendar","input[data-datepicker]",a),$("body").on("blur.calendar","input[data-datepicker]",r),$("body").bind(d,function(){$.datepicker.hide()})});